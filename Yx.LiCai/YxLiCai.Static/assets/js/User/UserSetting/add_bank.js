define("add_bank",["jquery","gxdialog","jcookie"],function(e,r,a){function t(e){d.gxDialog({title:"",width:280,closeBtn:!1,info:'<div class="pop-box"><p class="warning-color">'+e+"</p></div>",ok:function(){}})}function n(){1==p?(window.clearInterval(c),d("#repOld").hide(),d("#repNew").show(),d("#repNew").html("重新发送"),d("#TimeMove").html("60"),d(".yx-tips").html("")):(p--,d("#TimeMove").html(p))}function s(){var e=d("#BankName").html().replace(/[ ]/g,""),r=d("#BankCard").val().replace(/[ ]/g,""),a=d("#Phone").val().replace(/[ ]/g,""),s=d("#MyRealCard").val().replace(/[ ]/g,""),l=d("#MyRealName").val().replace(/[ ]/g,"");return""==e?void t("请选择开户银行"):""==r?void t("请输入银行卡号"):o(r)?""==a?void t("请输入手机号"):i(a)?(d(".yx-tips").css("display",""),void d.ajax({type:"POST",async:!1,url:"/UserSetting/SendBoundBankCard",data:{BankName:e,BankCard:r,Phone:a,Card:s,RealName:l},success:function(e){if(1==e.Status){g=!0,d("#repOld").show(),d("#repNew").hide(),p=v,c=window.setInterval(n,1e3);var r=a.length,s=a.substr(parseInt(r-4));d(".yx-tips").html("我们已将验证码发送至您****"+s+"的手机，请耐心等待。")}else g=!1,event.preventDefault(),t(e.Message)},error:function(e,r,a){}})):void t("手机号输入不正确，请修改"):void t("银行卡输入不正确，请修改")}function i(e){return/^13\d{9}$/g.test(e)||/^14[0-9]\d{8}$/g.test(e)||/^15[0-9]\d{8}$/g.test(e)||/^18[0-9]\d{8}$/g.test(e)||/^17[0-9]\d{8}$/g.test(e)?!0:!1}function o(e){for(var r=e.substr(e.length-1,1),a=e.substr(0,e.length-1),t=new Array,n=a.length-1;n>-1;n--)t.push(a.substr(n,1));for(var s=new Array,i=new Array,o=new Array,l=0;l<t.length;l++)(l+1)%2==1?2*parseInt(t[l])<9?s.push(2*parseInt(t[l])):i.push(2*parseInt(t[l])):o.push(t[l]);for(var d=new Array,u=new Array,c=0;c<i.length;c++)d.push(parseInt(i[c])%10),u.push(parseInt(i[c])/10);for(var p=0,g=0,v=0,f=0,h=0,y=0;y<s.length;y++)p+=parseInt(s[y]);for(var m=0;m<o.length;m++)g+=parseInt(o[m]);for(var w=0;w<d.length;w++)v+=parseInt(d[w]),f+=parseInt(u[w]);h=parseInt(p)+parseInt(g)+parseInt(v)+parseInt(f);var k=parseInt(h)%10==0?10:parseInt(h)%10,b=10-k;return r==b?!0:!1}function l(e){if(e=e.toUpperCase(),!/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test(e))return!1;var r,a;if(r=e.length,15==r){if(year="19"+e.substr(6,2),year>2015||year<1900)return!1}else if(18==r&&(year=e.substr(6,4),year>2015||year<1900))return!1;if(15==r){a=new RegExp(/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/);var t,n=e.match(a),s=new Date("19"+n[2]+"/"+n[3]+"/"+n[4]);if(t=s.getYear()==Number(n[2])&&s.getMonth()+1==Number(n[3])&&s.getDate()==Number(n[4])){var i,o=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),l=new Array("1","0","X","9","8","7","6","5","4","3","2"),d=0;for(e=e.substr(0,6)+"19"+e.substr(6,e.length-6),i=0;17>i;i++)d+=e.substr(i,1)*o[i];return e+=l[d%11],!0}return!1}if(18==r){a=new RegExp(/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/);var t,n=e.match(a),s=new Date(n[2]+"/"+n[3]+"/"+n[4]);if(t=s.getFullYear()==Number(n[2])&&s.getMonth()+1==Number(n[3])&&s.getDate()==Number(n[4])){var u,i,o=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),l=new Array("1","0","X","9","8","7","6","5","4","3","2"),d=0;for(i=0;17>i;i++)d+=e.substr(i,1)*o[i];return u=l[d%11],u!=e.substr(17,1)?!1:!0}return!1}return!1}var d=jQuery=e("jquery"),u=(e("gxdialog"),e("jcookie"),d("#returnUrl").val());d.gxDialog.defaults.background="#000";var c,p,g=!1,v=60;d("#repNew").click(function(){s()}),d("#ok-bank").click(function(){var e=d("#BankName").html().replace(/[ ]/g,""),r=d("#BankCard").val().replace(/[ ]/g,""),a=d("#Phone").val().replace(/[ ]/g,""),n=d("#MyRealCard").val().replace(/[ ]/g,""),s=d("#MyRealName").val().replace(/[ ]/g,"");if(""==e)return void t("请选择开户银行");var o=/^(\d{15,19})$/g;if(""==r)return void t("请输入银行卡号");if(!o.test(r))return void t("银行卡输入不正确，请修改");if(""==a)return void t("请输入手机号");if(!i(a))return void t("手机号输入不正确，请修改");var c=d("#phoneCode").val().replace(/[ ]/g,"");return""==c?void t("请输入手机验证码"):l(n)?void d.ajax({type:"POST",async:!1,url:"/UserSetting/ConfimBoundBankCard",data:{BankName:e,BankCard:r,Phone:a,validatecode:c,Card:n,RealName:s},success:function(e){1==e.Status?window.location.href=""!=u?u:"/UserSetting/":t(e.Message)},error:function(e,r,a){}}):void t("身份证格式不正确")});var f=d(".J_selectBank"),h=d("#J_bankInfor");h.on("click",function(){d.gxDialog({title:"",width:280,closeBtn:!1,info:document.getElementById("selectBank")})}),f.on("click","li",function(e){e.preventDefault();var r=d(this),a=r.find("img").attr("src"),t=r.find("p>b").html();h.find("img").show().attr("src",a),h.find("span").show().text(t),h.find("b").hide(),r.addClass("checked"),r.siblings("li").removeClass("checked"),d.gxDialog.close()}),d(document).ready(function(){d(".yx-tips").css("display","none")})}),seajs.use("add_bank");